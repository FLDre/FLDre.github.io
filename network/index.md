# Unix 网络编程


# 字节序

## 主机字节序

主机字节序是指特定计算机系统或架构使用的字节序。主机字节序有两种主要类型：

1. 小端序(Little-endian)

- **低位**字节存入**低地址**，**高位**字节存入**高地址**

- 常见的小端序系统包括大多数的**x86架构**(如Intel和AMD处理器)

2. 大端序(Big-endian)

- **低位**字节存入**高地址**，**高位**字节存入**低地址**

- 常见的大端序系统包括一些**RISC处理器**(如SPARC、PowerPC)

例如，将`0x12345678`写入`0x1000`开始的内存中，以**小端序**和**大端序**模式存放结果如下:

| 内存地址 | 0x1000 | 0x10001 | 0x10002 | 0x10003 |
|:-------:|:------:|:-------:|:-------:|:-------:|
| 小端序 | 0x78 | 0x56 | 0x34 | 0x12 |
| 大端序 | 0x12 | 0x34 | 0x56 | 0x78 |


## 网络字节序

网络字节序是一种标准化的字节序，用于确保在不同系统之间正确传输数据

网络字节序采用**大端序**(Big-endian)

```c
struct sockaddr_in* saddr;
if (saddr->sin_addr.s_addr != htonl(INADDR_LOOPBACK)) {
    // 如果条件为真，表示IP地址不是回环地址，执行此块代码
}
```

- `s_addr`是`sin_addr`中的一个字段，表示实际的`IP`地址，以**网络字节序**(大端序)存储

- `INADDR_LOOPBACK`是一个常量值`0x7F000001`(即`127.0.0.1`的二进制表示)，要使用`htonl`将其转换为网络字节序

- `htonl`(Host TO Network Long)

    - 将32位整数从主机字节序转换为网络字节序

    - ```c
      uint32_t htonl(uint32_t hostlong);
      ```



